# Глобальные настройки
global:
  # Тайм-аут разрешения алерта (переход в статус RESOLVED) при отсутствии данных.
  resolve_timeout: 5m

# [ROUTING] Логика маршрутизации алертов
route:
  # Группировка: объединение алертов с одинаковыми именами в одно сообщение.
  # Цель: предотвращение лавины сообщений (1 сообщение со списком вместо 10 отдельных).
  group_by: ['alertname']
  
  # Групповое ожидание: время накопления "пачки" алертов перед отправкой первого сообщения.
  group_wait: 10s
  
  # Интервал группы: частота отправки обновлений по текущей группе алертов.
  group_interval: 10s
  
  # Повтор: интервал повторной отправки уведомления при неисправленной проблеме.
  # Рекомендация: значение от 3h до 24h для предотвращения спама.
  repeat_interval: 1h
  
  # Получатель по умолчанию (fallback, если не сработали другие правила).
  receiver: 'blackhole'

  # [ВАЖНО] Правила маршрутизации
  routes:
    # Правило: Отправка Critical и Warning в Telegram
    - matchers:
        - severity =~ "critical|warning"
      receiver: 'telegram-alerts'
      continue: true # Продолжение обработки (проверка следующих правил, например Email)

    # Правило (ОТКЛЮЧЕНО): Отправка только Critical на Email
    # - matchers:
    #     - severity = "critical"
    #   receiver: 'email-alerts'

# [RECEIVERS] Конфигурация получателей
receivers:
  # 1. Заглушка ("Черная дыра"). Блокировка отправки алертов.
  - name: 'blackhole'

  # 2. Пример настройки Telegram
  - name: 'telegram-alerts'
    telegram_configs:
      - bot_token: 'bot_token' # Токен от @BotFather
        chat_id: 123456789         # ID чата или группы (получение через @userinfobot)
        parse_mode: 'HTML'
        # Шаблон сообщения для Telegram:
        message: '<b>{{ .Status | toUpper }}</b>: {{ .CommonAnnotations.summary }}\n{{ .CommonAnnotations.description }}'

  # 3. Пример настройки Email (ОТКЛЮЧЕНО)
  # - name: 'email-alerts'
  #   email_configs:
  #     - to: 'admin@example.com'
  #       from: 'monitoring@example.com'
  #       smarthost: 'smtp.gmail.com:587'
  #       auth_username: 'user@example.com'
  #       auth_password: 'password'
  #       # Шаблон заголовка письма
  #       headers:
  #         Subject: 'Prometheus Alert: {{ .GroupLabels.alertname }}'
