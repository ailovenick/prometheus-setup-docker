services:
  nginx:
    image: nginx:latest
    container_name: nginx
    restart: unless-stopped
    volumes:
      # [CONFIG] Монтирование конфигурационного файла внутрь контейнера.
      # ВАЖНО: В конфигурации ОБЯЗАТЕЛЬНО должен присутствовать location /stub_status
      # для корректной работы nginx-exporter.
      - ./config/default.conf:/etc/nginx/conf.d/default.conf
    ports:
      # Проброс порта 8080 хоста на порт 80 контейнера.
      # Доступ к сайту: http://localhost:8080
      - "8080:80"

  nginx-exporter:
    image: nginx/nginx-prometheus-exporter:latest
    container_name: nginx-exporter
    restart: unless-stopped
    command:
      # [SCRAPE TARGET] Адрес обращения экспортера к Nginx для сбора статистики.
      # http://nginx:80 — обращение по имени сервиса внутри сети Docker.
      # /stub_status — стандартный путь модуля ngx_http_stub_status_module.
      - '-nginx.scrape-uri=http://nginx:80/stub_status'
    ports:
      # Порт отдачи метрик для Prometheus.
      - "9113:9113"
    depends_on:
      - nginx
