# Подключение Windows-хоста к мониторингу (windows_exporter)

Для сбора метрик с Windows используется **windows_exporter**. Самый надежный и простой способ установки — использование MSI-пакета.

---

## 1. Установка через MSI

1. Скачайте актуальный релиз `.msi`  с [GitHub репозитория](https://github.com/prometheus-community/windows_exporter/releases).
2. Запустите установщик. При установке вы увидите:

### Пояснение по полям установки:

1.  **Comma-separated list of collectors... (Список коллекторов)**
    *   *Что это:* Какие метрики собирать.
    *   *Что писать:* Оставьте пустым, чтобы использовать стандартный набор (`[defaults]`).
    *   [Список всех коллекторов в документации](https://github.com/prometheus-community/windows_exporter?tab=readme-ov-file#collectors).

2.  **Additional command line flags (Доп. флаги)**
    *   *Что это:* Параметры запуска для тонкой настройки.
    *   *Пример:* `--log.level debug` (включает подробное журналирование для поиска ошибок).
    *   *Что писать:* Оставьте пустым.

3.  **Port to listen (Порт)**
    *   *По умолчанию:* `9182`
    *   *Что писать:* Меняйте только если этот порт занят другим приложением.

4.  **Path to config file (Путь к конфигу)**
    *   *Зачем нужен:* Позволяет вынести сложные настройки в отдельный файл вместо длинной командной строки. Например, через конфиг можно указать regex-фильтры, чтобы **игнорировать** конкретные диски или сетевые адаптеры.
    *   *По умолчанию:* `config.yaml` (программа ищет этот файл в папке установки).
    *   *Что делать:* Если у вас нет заготовленного `config.yaml`, просто оставьте поле как есть. Экспортер запустится с дефолтными настройками.

---

## 2. Как это работает после установки

*   **Фоновая служба:** Установщик создает системную **службу Windows** (`windows_exporter`) с типом запуска "Автоматически". 
*   **Важно:** Её **не будет** в списке "Автозагрузка" в Диспетчере задач, так как она работает на уровне системы.
*   **Порт:** По умолчанию используется TCP-порт **9182**.
*   **Проверка:** Откройте браузер по адресу `http://localhost:9182/metrics`

---

## 3. Настройка Firewall (Важно)

Чтобы Prometheus смог забрать данные, нужно разрешить входящие подключения на порт 9182:

```powershell
# Запустите PowerShell от имени Администратора
New-NetFirewallRule -DisplayName "Prometheus windows_exporter" -Direction Inbound -Action Allow -Protocol TCP -LocalPort 9182
```

---

## 4. Добавление в Prometheus

Добавьте цель в ваш `prometheus.yml`:

```yaml
  - job_name: 'windows'
    static_configs:
      - targets: ['<IP_WINDOWS_МАШИНЫ>:9182']
```