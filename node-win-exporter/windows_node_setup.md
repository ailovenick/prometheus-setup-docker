# Подключение Windows-хоста к мониторингу (windows_exporter)

Инструмент сбора метрик: **windows_exporter**.
Рекомендуемый метод установки: MSI-пакет.

---

## 1. Установка через MSI

1. **Скачивание:** Загрузка актуального релиза `.msi` из [GitHub репозитория](https://github.com/prometheus-community/windows_exporter/releases).
2. **Запуск:** Выполнение установщика. Описание параметров установки ниже.

### Параметры установки:

1.  **Comma-separated list of collectors... (Список коллекторов)**
    *   **Назначение:** Определение списка собираемых метрик.
    *   **Рекомендация:** Оставить пустым для использования стандартного набора (`[defaults]`).
    *   **Справочник:** [Полный список коллекторов](https://github.com/prometheus-community/windows_exporter?tab=readme-ov-file#collectors).

2.  **Additional command line flags (Доп. флаги)**
    *   **Назначение:** Параметры запуска для тонкой настройки.
    *   **Пример:** `--log.level debug` (включение подробного журналирования).
    *   **Рекомендация:** Оставить пустым.

3.  **Port to listen (Порт)**
    *   **Значение по умолчанию:** `9182`
    *   **Условие изменения:** Конфликт порта с другим приложением.

4.  **Path to config file (Путь к конфигу)**
    *   **Назначение:** Вынос сложных настроек (regex-фильтры, списки исключений) в отдельный файл.
    *   **Значение по умолчанию:** `config.yaml` (поиск в директории установки).
    *   **Действие при отсутствии:** Игнорирование (запуск с настройками по умолчанию).

---

## 2. Принцип работы (Post-Install)

*   **Фоновая служба:** Создание системной **службы Windows** (`windows_exporter`) с автоматическим типом запуска.
*   **Примечание:** Отсутствие в списке "Автозагрузка" диспетчера задач (работа на системном уровне).
*   **Порт:** Использование TCP-порта **9182** (по умолчанию).
*   **Проверка работоспособности:** Доступность адреса `http://localhost:9182/metrics`

---

## 3. Настройка Firewall (Обязательно)

Требование: разрешение входящих подключений на порт 9182.

```powershell
# Запуск PowerShell от имени Администратора
New-NetFirewallRule -DisplayName "Prometheus windows_exporter" -Direction Inbound -Action Allow -Protocol TCP -LocalPort 9182
```

---

## 4. Добавление в Prometheus

Пример конфигурации цели в `prometheus.yml`:

```yaml
  - job_name: 'windows'
    static_configs:
      - targets: ['<IP_WINDOWS_МАШИНЫ>:9182']
```